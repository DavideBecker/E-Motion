"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Truck=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.busy=!1,e.location=Nodes.getStuttgart(),e.position=createVector(e.location.x,e.location.y),e.capacity=400,e.charge=e.capacity,e.dischargeSpeed=0,e.type="truck",e.workTarget=!1,trucks.push(e),e}return _inherits(t,Vehicle),_createClass(t,[{key:"chargeCar",value:function(e){if(e.charge/e.capacity<environment.simulation.carChargeLimit)e.charge+=e.chargeSpeed;else{if(e.charge>e.capacity){var t=e.charge-e.capacity;e.charge-=t,environment.simulation.totalCarCharge-=t}this.busy=!1,this.rescueTarget=!1,e.isStuck=!1}}},{key:"chargeCity",value:function(e){if(e.needsCharging()){for(var t in e.parkedCars){var r=e.parkedCars[t];if(r.charge/r.capacity<environment.simulation.carChargeLimit&&(r.charge+=r.chargeSpeed/e.parkedCars.length,environment.simulation.totalCarCharge+=r.chargeSpeed/e.parkedCars.length),r.charge>r.capacity){var i=r.charge-r.capacity;r.charge-=i,environment.simulation.totalCarCharge-=i}}e.calculateAverageCharge()}else this.busy=!1,this.rescueTarget=!1}},{key:"getNewWork",value:function(){switch(this.busy=!0,this.workTarget=queue.shift(),this.workTarget.type){case"car":this.driveTo(this.workTarget.location);break;case"city":this.driveTo(this.workTarget)}}},{key:"work",value:function(){switch(this.workTarget.type){case"car":this.chargeCar(this.workTarget);break;case"city":this.chargeCity(this.workTarget)}}},{key:"render",value:function(){applyMatrix(),fill("#444444"),strokeWeight(4),stroke("#37BDFF"),translate(this.position.x*environment.scale,this.position.y*environment.scale),this.next&&rotate(atan2(this.position.y-this.next.y,this.position.x-this.next.x)),rect(1.05*-environment.truckSize,0,environment.truckSize/1.5,environment.truckSize/1.5,4),rect(0,0,1.5*environment.truckSize,environment.truckSize,4),resetMatrix()}},{key:"update",value:function(){this.busy&&!this.isDriving?this.work():queue.length&&!this.busy?this.getNewWork():this.isDriving||"Stuttgart"==this.location.name||this.driveTo(Nodes.getStuttgart()),this.updatePosition(),this.render()}}]),t}();
//# sourceMappingURL=Truck.js.map
