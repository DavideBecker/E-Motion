{"version":3,"sources":["modules/Truck.js"],"names":["Truck","busy","location","Nodes","getStuttgart","position","createVector","x","y","capacity","charge","dischargeSpeed","type","workTarget","trucks","push","car","environment","simulation","carChargeLimit","chargeSpeed","rescueTarget","isStuck","city","needsCharging","id","parkedCars","length","calculateAverageCharge","queue","shift","driveTo","chargeCar","chargeCity","applyMatrix","fill","strokeWeight","stroke","translate","scale","next","rotate","atan2","rect","truckSize","resetMatrix","isDriving","work","getNewWork","name","updatePosition","render","Vehicle"],"mappings":"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","file":"Truck.js","sourcesContent":["class Truck extends Vehicle {\n    constructor() {\n        super()\n\n        this.busy = false;\n        this.location = Nodes.getStuttgart()\n        this.position = createVector(this.location.x, this.location.y);\n        this.capacity = 400\n        this.charge = this.capacity;\n        this.dischargeSpeed = 0;\n        this.type = 'truck'\n        this.workTarget = false\n\n        trucks.push(this)\n    }\n\n    chargeCar(car) {\n        if(car.charge / car.capacity < environment.simulation.carChargeLimit) { //car.charge / car.capacity < environment.simulation.carChargeLimit) {\n            car.charge += car.chargeSpeed\n        } else {\n            if(car.charge > car.capacity) {\n                car.charge = car.capacity\n            }\n            this.busy = false\n            this.rescueTarget = false\n            car.isStuck = false\n        }\n    }\n\n    chargeCity(city) {\n        if(city.needsCharging()) {\n            for(var id in city.parkedCars) {\n                var car = city.parkedCars[id];\n\n                if(car.charge / car.capacity < environment.simulation.carChargeLimit) { //car.charge / car.capacity < environment.simulation.carChargeLimit) {\n                    car.charge += car.chargeSpeed / city.parkedCars.length\n                }\n\n                if(car.charge > car.capacity) {\n                    car.charge = car.capacity\n                }\n            }\n\n            city.calculateAverageCharge();\n        } else {\n            this.busy = false\n            this.rescueTarget = false\n        }\n    }\n\n    getNewWork() {\n        this.busy = true;\n        this.workTarget = queue.shift();\n\n        switch (this.workTarget.type) {\n        case 'car':\n            this.driveTo(this.workTarget.location)\n            break;\n\n        case 'city':\n            this.driveTo(this.workTarget)\n            break;\n\n        default:\n            break;\n        }\n    }\n\n    work() {\n        switch (this.workTarget.type) {\n        case 'car':\n            this.chargeCar(this.workTarget);\n            break;\n\n        case 'city':\n            this.chargeCity(this.workTarget);\n            break;\n\n        default:\n            break;\n        }\n    }\n\n    render() {\n        applyMatrix()\n        fill('#444444')\n        strokeWeight(4)\n        stroke('#37BDFF')\n        translate(this.position.x * environment.scale, this.position.y * environment.scale)\n        if(this.next) {\n            rotate(atan2(this.position.y - this.next.y, this.position.x - this.next.x))\n        }\n        rect(\n            0,\n            0,\n            environment.truckSize * 1.5,\n            environment.truckSize,\n            4\n        )\n        resetMatrix()\n    }\n\n    update() {\n        if(this.busy && !this.isDriving) {\n            this.work()\n        } else if(queue.length && !this.busy) {\n            this.getNewWork()\n        } else if(!this.isDriving && this.location.name != 'Stuttgart') {\n            this.driveTo(Nodes.getStuttgart())\n        }\n\n        this.updatePosition()\n        this.render()\n    }\n}\n"]}